<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Computação Gráfica</title>

    <title>Teste Cubo 3D</title>

</head>

<div class="span6">
    <div class="well">
        <h2 style="text-align:center;"> Transformações 3D</h2>

        <p>Cubo 3D</p>

        <!--------------------DESENHA FIGURA------------------------------------------------------------------------------->
        <fieldset>
            <div class="col-lg-2">
                <input type="text" id="x1" value="100" class="form-control" placeholder="x1">
            </div>
            <div class="col-lg-2">
                <input type="text" id="y1" value="100" class="form-control" placeholder="y1">
            </div>
            <div class="col-lg-2">
                <input type="text" id="z1" value="40" class="form-control" placeholder="z1">
            </div>
        </fieldset>

        <fieldset>
            <div class="col-lg-2">
                <input type="text" id="x2" value="40" class="form-control" placeholder="x2">
            </div>
            <div class="col-lg-2">
                <input type="text" id="y2" value="40" class="form-control" placeholder="y2">
            </div>

            <button id="botaodesenhar" class="btn btn-primary">
                <i class="icon-pencil icon-white"></i> Desenhar
            </button>
            <button id="erasebutton" class="btn btn-danger">
                <i class="icon-trash icon-white"></i> Apagar
            </button>
        </fieldset>

        <fieldset>
            <!--------------------TRANSLAÇÃO------------------------------------------------------------------------------------->
            <div id="translacao">
                <legend>Translação</legend>
                <input type="number" id="tx" style="width: 100%" class="form-control" placeholder="Tx">
                <input type="number" id="ty" style="width: 100%" class="form-control" placeholder="Ty">
                <input type="number" id="tz" style="width: 100%" class="form-control" placeholder="Tz">

                <button id="transladebutton" style="width: 100%" class="btn btn-sm btn-info">
                    Transladar
                </button>

            </div>
        </fieldset>
    </div>
</div>
<!-- jQuery -->
<script src="assets/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="assets/js/bootstrap.min.js"></script>

<SCRIPT TYPE="text/javascript" src="canvas/js/dda.js"></SCRIPT>
<SCRIPT TYPE="text/javascript" src="canvas/js/drawing.js"></SCRIPT>
<SCRIPT TYPE="text/javascript" src="canvas/js/jquery-1.7.2.js"></SCRIPT>
<SCRIPT TYPE="text/javascript" src="canvas/js/dynamictable.js"></SCRIPT>
<SCRIPT TYPE="text/javascript" src="canvas/js/transformacoes.js"></SCRIPT>

<script type="text/javascript">
    var width;
    var height;

    $(document).ready(function () {
        canvas = document.getElementById("thecanvas");
        ctx = canvas.getContext("2d");
        ctx.fillStyle = "rgb(0,0,0)";
        width = parseInt(canvas.getAttribute("width"));
        height = parseInt(canvas.getAttribute("height"));
        ctx.fillRect(0, 0, 800, 400);
        ctx.strokeStyle = "rgb(255,55,255)"
        initializecanvas(ctx);

    });
    $("#botaodesenhar").click(function () {

        x1 = parseFloat($("#x1").val());
        x2 = parseFloat($("#x2").val());
        y1 = parseFloat($("#y1").val());
        y2 = parseFloat($("#y2").val());
        z1 = parseFloat($("#z1").val());

        cubo();
//        facesCubo();
//        startDemo();

    });
    $("#transladebutton").click(function () {
        initializecanvas(ctx);
        var auxX = $('#tx').val();
        var auxY = $('#ty').val();
        var auxZ = $('#tz').val();

        transladado = transladar3d(cub, auxX, auxY, auxZ);

        cub = cuboTransformado(transladado, ctx);

        console.log(cub);

        return false;
    });

    function transladar3d(objeto, tx, ty, tz) {

        var trans3d = [
            [1, 1, 0, tx],
            [0, 1, 0, ty],
            [0, 0, 1, tz],
            [0, 0, 0, 1]

        ];
        return multiplicacao(trans3d, objeto)
    }

    function Point3D(x, y, z) {
        this.x = x;
        this.y = y;
        this.z = z;

//        this.project = function (viewWidth, viewHeight, fov, viewDistance) {
//            var factor, x, y;
//            factor = fov / (viewDistance + this.z); //fator de distancia
//            x = this.x * factor + viewWidth / 2;
//            y = this.y * factor + viewHeight / 2;
//            return new Point3D(x, y, this.z);
//        }
    }

    function cubo() {

        cub = [];

            A = new Point3D(-x1, y1, -z1),      //No quadrilátero, temos uma matriz 4 x 2, ou seja, uma polígono com 4 vértices, em que cada vértice tem duas coordenadas.
            B = new Point3D(x1, y1, -z1),       // No cubo, teríamos um prisma com 8 vértices, em que cada vértice teria três coordenadas. Assim, a matriz seria 8 x 3
            C = new Point3D(x1, -y1, -z1),
            D = new Point3D(-x1, -y1, -z1),
            E = new Point3D(-x2, y2, z1),
            F = new Point3D(x2, y2, z1),
            G = new Point3D(x2, -y2, z1),
            H = new Point3D(-x2, -y2, z1)

        linha1 = dda(A, B);
        cub.push([A.x, A.y, A.z]);

        linha2 = dda(B, C);
        cub.push([B.x, B.y, C.z]);

        linha3 = dda(C, D);
        cub.push([C.x, C.y, C.z]);

        linha4 = dda(A, D);
        cub.push([D.x, D.y, D.z]);

        linha5 = dda(A, E);
        cub.push([A.x, A.y, E.z]);

        linha6 = dda(B, F);
        cub.push([B.x, B.y, F.z]);

        linha7 = dda(C, G);
        cub.push([C.x, C.y, G.z]);

        linha8 = dda(D, H);
        cub.push([D.x, D.y, H.z]);

        linha9 = dda(E, F);
        cub.push([E.x, E.y, E.z]);
//
        linha10 = dda(F, G);
        cub.push([F.x, F.y, G.z]);
//
        linha11 = dda(G, H);
        cub.push([G.x, G.y, G.z]);

        linha12 = dda(E, H);
        cub.push([H.x, H.y, H.z]);

        draw(linha1, ctx);
        draw(linha2, ctx);
        draw(linha3, ctx);
        draw(linha4, ctx);

        draw(linha5, ctx);
        draw(linha6, ctx);
        draw(linha7, ctx);
        draw(linha8, ctx);

        draw(linha9, ctx);
        draw(linha10, ctx);
        draw(linha11, ctx);
        draw(linha12, ctx);

        console.log(cub);

        return cub;

    }
    function cuboTransformado(objetoEscalado, ctx) {

        cub = [];

        objetoEscalado = matriz_transposta(objetoEscalado);

        A = new Point(objetoEscalado[0][0][0], objetoEscalado[0][1][0], objetoEscalado[0][0][1]);
        cub.push([A.x, A.y, A.z]);

        B = new Point(objetoEscalado[1][0][0], objetoEscalado[1][1][0], objetoEscalado[1][0][1]);
        cub.push([B.x, B.y, B.z]);

        C = new Point(objetoEscalado[2][0][0], objetoEscalado[2][1][0], objetoEscalado[2][0][1]);
        cub.push([C.x, C.y, C.z]);

        D = new Point(objetoEscalado[3][0][0], objetoEscalado[3][1][0], objetoEscalado[3][0][1]);
        cub.push([D.x, D.y, D.z]);

        E = new Point(objetoEscalado[4][0][0], objetoEscalado[4][1][0], objetoEscalado[4][0][1]);
        cub.push([A.x, A.y, A.z]);

        F = new Point(objetoEscalado[5][0][0], objetoEscalado[5][1][0], objetoEscalado[5][0][1]);
        cub.push([B.x, B.y, B.z]);

        G = new Point(objetoEscalado[6][0][0], objetoEscalado[6][1][0], objetoEscalado[6][0][1]);
        cub.push([C.x, C.y, C.z]);

        H = new Point(objetoEscalado[7][0][0], objetoEscalado[7][1][0], objetoEscalado[7][0][1]);
        cub.push([D.x, D.y, D.z]);

//
        linha1 = dda(A,B);

        linha2 = dda(B,C);

        linha3 = dda(C,D);

        linha4 = dda(A,D);

//
        linha5 = dda(A, E);

        linha6 = dda(B, F);

        linha7 = dda(C, G);

        linha8 = dda(D, H);


        linha9 = dda(E, F);

        linha10 = dda(F, G);

        linha11 = dda(G, H);

        linha12 = dda(E, H);
//
        draw(linha1, ctx);
        draw(linha2, ctx);
        draw(linha3, ctx);
        draw(linha4, ctx);

        draw(linha5, ctx);
        draw(linha6, ctx);
        draw(linha7, ctx);
        draw(linha8, ctx);

        draw(linha9, ctx);
        draw(linha10, ctx);
        draw(linha11, ctx);
        draw(linha12, ctx);

        return cub;
    }

    function multiplicacao(operador, objeto) {

        var objTramsformado, i, r, j, s, k;

        objTramsformado = [];

        objeto = matriz_transposta(objeto);

        for (i = 0; i < operador.length; i++) {
            r = [];
            for (j = 0; j < objeto[0].length; j++) {
                s = 0;
                for (k = 0; k < objeto.length; k++) {
                    s += operador[i][k] * objeto[k][j];
                }
                r.push(s);
            }
            objTramsformado.push(r);
        }

        return objTramsformado;
    }

    function matriz_transposta(matriz) {

        var i, j, aux;

        transposta = [];

        for (i = 0; i < matriz[0].length; i++) {
            aux = [];
            for (j = 0; j < matriz.length; j++) {
                aux.push(matriz[j][i]);
            }
            transposta.push(aux);
        }

        return transposta;
    }

</script>

<body>
<h2>Cubo 3D</h2>
<canvas id="thecanvas" width="800" height="400">

</canvas>
</body>
</html>